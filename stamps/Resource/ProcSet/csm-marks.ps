%!PS-Adobe-3.0
%%Creator: Sergey S. Betke <sergey.s.betke@yandex.ru>
%%Copyright: 2018 Sergey S. Betke <sergey.s.betke@yandex.ru>
%%+ See LICENSE at https://github.com/Metrolog/marks
%%DocumentData: Clean7Bit
%%DocumentNeededResources: Encoding (CP1251Encoding)
%%+: Encoding (CP1253Encoding)
%%+: ProcSet (csm-marks-params) 2.3 0
%%+: ProcSet (csm-marks-cyr-signs) 2.2 0
%%+: ProcSet (csm-marks-greek-signs) 2.2 0
%%+: ProcSet (operators) 2.3 0
%%+: ProcSet (procs) 2.3 0
%%+: ProcSet (arrays) 2.2 0
%%+: ProcSet (boxes) 2.2 0
%%+: ProcSet (fonts) 2.2 0
%%+: ProcSet (graphics) 2.2 0
%%+: ProcSet (math) 2.2 0
%%+: ProcSet (roman) 2.2 0
%%+: ProcSet (si) 2.2 0
%%+: ProcSet (graphics-alignments) 2.2 0
%%+: ProcSet (image-st) 2.2 0
%%DocumentSuppliedResources: Font stamp_sign_cyr
%%+: Font stamp_sign_greek
%%+: Font stamp_id
%%+: Font stamp_gmc
%%+: Font stamp_period
%%+: Font stamp_year
%%+: Font stamp_K
%%+: ProcSet (csm-marks)
%%Version: 2.2 0
%%EndComments
%%BeginProlog

%%IncludeResource: ProcSet csm-marks-params 2.3 0

%%IncludeResource: ProcSet operators 2.3 0
%%IncludeResource: ProcSet procs 2.3 0
%%IncludeResource: ProcSet arrays 2.2 0
%%IncludeResource: ProcSet boxes 2.2 0
/boxes /ProcSet findresource begin

%%IncludeResource: ProcSet fonts 2.2 0
%%IncludeResource: ProcSet graphics 2.2 0
/graphics /ProcSet findresource begin

%%IncludeResource: ProcSet math 2.2 0
%%IncludeResource: ProcSet roman 2.2 0
%%IncludeResource: ProcSet si 2.2 0
/si /ProcSet findresource begin

%%IncludeResource: ProcSet graphics-alignments 2.2 0
/graphics-alignments /ProcSet findresource begin

%%IncludeResource: ProcSet image-st 2.2 0

/stamp_sign_cyr /Font resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-Font
%%BeginResource: Font stamp_sign_cyr
/stamp_sign_cyr (GOST2930-62forMarks) /CP1251Encoding  /fonts /ProcSet findresource /reencodefont get exec  pop
%%EndResource:
} ifelse

/stamp_sign_greek /Font resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-Font
%%BeginResource: Font stamp_sign_greek
/stamp_sign_greek (GOST2930-62forMarks) /CP1253Encoding  /fonts /ProcSet findresource /reencodefont get exec  pop
%%EndResource:
} ifelse

/stamp_id /Font resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-Font
%%BeginResource: Font stamp_id
/stamp_id  /stamp_sign_cyr findfont  definefont pop
%%EndResource:
} ifelse

/stamp_gmc /Font resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-Font
%%BeginResource: Font stamp_gmc
/stamp_gmc  /stamp_sign_cyr findfont  definefont pop
%%EndResource:
} ifelse

/stamp_period /Font resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-Font
%%BeginResource: Font stamp_period
/stamp_period  /stamp_sign_cyr findfont  definefont pop
%%EndResource:
} ifelse

/stamp_year /Font resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-Font
%%BeginResource: Font stamp_year
/stamp_year  /stamp_period findfont  definefont pop
%%EndResource:
} ifelse

/stamp_K /Font resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-Font
%%BeginResource: Font stamp_K
/stamp_K  /stamp_id findfont  definefont pop
%%EndResource:
} ifelse

%%IncludeResource: ProcSet csm-marks-cyr-signs 2.2 0
%%IncludeResource: ProcSet csm-marks-greek-signs 2.2 0

%(csm-marks) /ProcSet resourcestatus { pop pop } {
%!PS-Adobe-3.0 Resource-ProcSet
%%BeginResource: ProcSet (csm-marks)
/csm-marks  100 dict begin

/eexec { exch /ProcSet findresource exch get exec } bind def

/months % [ 1 2 3 ] --> (1) (2) (3)
{
  { 2 string  cvs } forall
} bind def
% [ 1 12 range ]  months ==

/quarters % [ 1 2 3 4 ] --> (I) (II) (III) (IV)
{
  /roman /ProcSet findresource /int_to_roman get  forall
} bind def
% [ 1 4 range ]  quarters ==

/year % --> ()
{
  ()
} bind def

/_year year def

/stamp_sign_path_helper % (sign) angle --> - (добавляем к текущему пути путь знака поверителя)
{
  1 dict begin
  /savedCTM matrix currentmatrix def
  rotate
  gsave
    currentpoint
    newpath
    moveto
    dup  true charpath
    flattenpath pathbbox
  grestore
  3 -1 roll add 2 div neg  3 1 roll add 2 div neg  exch  rmoveto
  true charpath
  savedCTM setmatrix
  end
} bind def

/stamp_sign_upath_helper % (sign) angle --> upath
{
  /stamp_sign_path_helper
  true path_as_upath
} def

gsave

/stamp_signs_upaths [
  2 dict begin
  /sign_scale 1  800 1000 div  div  def
    [ 0 180 90 270 ]
    {
      /angle exch def

      (stamp_sign_cyr) findfont
      sign_scale scalefont setfont
        /csm-marks-cyr-signs /stamp_signs_cyr eexec
        {
          angle stamp_sign_upath_helper
        }
      forall

      (stamp_sign_greek) findfont
      sign_scale scalefont setfont
        /csm-marks-greek-signs /stamp_signs_greek eexec
        {
          angle stamp_sign_upath_helper
        }
      forall
    }
  forall
  end
] def

grestore

/stamp_sign_upath % sign_N --> upath
{
  stamp_signs_upaths  exch 1 sub  get
} def


/verification_stamp_params <<
  /id_h_size  3.8  800 1000 div  div
  /sing_h_size  4.0  800 1000 div  div
  /year_h_size  6.0  800 1000 div  div
  /period_h_size  3  800 1000 div  div
  /rst_size 3  800 1000 div  div
  /h_size  18.0
  /bounds_thickness  0.5
>> readonly def

% генерация рисунка поверительного клейма
/csm_verification_stamp_path % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> -
{
  [
    << /arg /year  /type /integertype  /rangecheck [ 2000 2099 ] >>
    << /arg /period  /type /stringtype  /enumcheck [ [ 1 12  range ] months  [ 1 4 range ] quarters //_year ]  /default //_year >>
    << /arg /id  /type /stringtype  /lengthcheck [ 1 3 ] >>
    << /arg /sign  /type /integertype  /rangecheck [ 0 256 ]  /default 0 >>
    << /arg /size  /type /realtype  /rangecheck [ 3 mm  18 mm ]  /default 18 mm >>
    << /arg /is_for_production  /type /booleantype  /default true >>
  ] /procs /define_args eexec

  % сохраняем на стеке текущую матрицу преобразования системы координат для последующего восстановления
  matrix currentmatrix
  currentpoint translate
  args /size get  verification_stamp_params /h_size get  div  dup  scale
  9 9 translate

  % окружность
  verification_stamp_params /h_size get 2 div  0  moveto
  0 0  verification_stamp_params /h_size get 2 div  0 360 arc  closepath
  verification_stamp_params /h_size get 2 div verification_stamp_params /bounds_thickness get sub  0  moveto
  0 0  verification_stamp_params /h_size get 2 div verification_stamp_params /bounds_thickness get sub  360 0 arcn  closepath

  % шифр поверительного клейма организации
  (stamp_id) findfont
  verification_stamp_params /id_h_size get scalefont setfont
  0 -7.5 moveto
    args /id get
    string_center_bottom
  true charpath

  % год
  (stamp_year) findfont
  verification_stamp_params /year_h_size get scalefont setfont
  -5.5 0 moveto
        args /year get 4 string cvs
        dup length 2 sub
        1
      getinterval
    string_center_middle
  true charpath
  5.5 0 moveto
        args /year get 4 string cvs
        dup length 1 sub
        1
      getinterval
    string_center_middle
  true charpath

  % индивидуальный знак поверителя
    args /sign get 0 ne
    {
      matrix currentmatrix
        verification_stamp_params /sing_h_size get dup scale
        args /sign get stamp_sign_upath uappend
      setmatrix
    }
  if

    args /period get () eq
    {
      % знак СТ
      0 5.5 moveto
      currentpoint translate
      verification_stamp_params /rst_size get dup scale
      /image-st /ProcSet findresource /ust get  uappend
    }
    {
      % период
      (stamp_period) findfont
      verification_stamp_params /period_h_size get scalefont setfont
      -2.0 5.5 moveto
        args /period get
        string_center_middle
      true charpath

      % знак СТ
      2.5 5.5 moveto
      currentpoint translate
      verification_stamp_params /rst_size get dup scale
      /image-st /ProcSet findresource /ust get  uappend
    }
  ifelse

  % восстановливаем систему координат
  setmatrix

  /procs /leave_local_scope eexec
} bind def

/csm_verification_stamp_upath % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> user path
{
  /csm_verification_stamp_path
  false path_as_upath
} def

% генерация рисунка поверительного клейма для государственных научных метрологических
% институтов

/gmc_verification_stamp_path % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> -
{
  [
    << /arg /year  /type /integertype  /rangecheck [ 2000 2099 ] >>
    << /arg /period  /type /stringtype  /enumcheck [ [ 1 12  range ] months  [ 1 4 range ] quarters //_year ]  /default //_year >>
    << /arg /id  /type /stringtype  /lengthcheck [ 1 3 ] >>
    << /arg /sign  /type /integertype  /rangecheck [ 0 256 ]  /default 0 >>
    << /arg /size  /type /realtype  /rangecheck [ 3 mm  18 mm ]  /default 18 mm >>
    << /arg /is_for_production  /type /booleantype >>
  ] /procs /define_args eexec

  % сохраняем на стеке текущую матрицу преобразования системы координат для последующего восстановления
  matrix currentmatrix
  currentpoint translate
  args /size get  verification_stamp_params /h_size get  div  dup  scale
  9 9 translate

  % окружность
  18 2 div  0  moveto
  0 0  18 2 div  0 360 arc  closepath
  18 2 div 0.5 sub  0  moveto
  0 0  18 2 div 0.5 sub  360 0 arcn  closepath

  % знак Гмц
  (stamp_gmc) findfont
  verification_stamp_params /id_h_size get scalefont setfont
  0 -7.5 moveto
    (Гмц)
    string_center_bottom
  true charpath

  % год
  (stamp_year) findfont
  verification_stamp_params /year_h_size get scalefont setfont
  -5.5 0 moveto
        args /year get 4 string cvs
        dup length 2 sub
        1
      getinterval
      dup
    string_center_middle
  true charpath
  string_BBox size_of_BBox pop
  5.5 0 moveto
        args /year get 4 string cvs
        dup length 1 sub
        1
      getinterval
      dup
    string_center_middle
  true charpath
  string_BBox size_of_BBox pop  neg

    add  2 div
  % шифр поверительного клейма
  matrix currentmatrix
      exch
      0
    pop pop % translate
    1 1 scale
    (stamp_id) findfont
    verification_stamp_params /id_h_size get scalefont setfont
    0 0 moveto
      args /id get
      string_center_middle
    true charpath
  setmatrix

    args /period get () eq
    {
      % знак СТ
      0 5.5 moveto
      currentpoint translate
      verification_stamp_params /rst_size get dup scale
      /image-st /ProcSet findresource /ust get  uappend
    }
    {
      % период
      (stamp_period) findfont
      verification_stamp_params /period_h_size get scalefont setfont
      -2.0 5.5 moveto
        args /period get
        string_center_middle
      true charpath

      % знак СТ
      2.5 5.5 moveto
      currentpoint translate
      verification_stamp_params /rst_size get dup scale
      /image-st /ProcSet findresource /ust get  uappend
    }
  ifelse

  % восстановливаем систему координат
  setmatrix

  /procs /leave_local_scope eexec
} bind def

/gmc_verification_stamp_upath % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> user path
{
  /gmc_verification_stamp_path
  false path_as_upath
} def


% генерация рисунка поверительного клейма для юридических лиц и индивидуальных предпринимателей

/verification_stamp_rect_params <<
  /id_h_size  2.5  800 1000 div  div
  /sing_h_size  2.25  800 1000 div  div
  /year_h_size  5.0  800 1000 div  div
  /period_h_size  2  800 1000 div  div
  /rst_size  2  800 1000 div  div
  /h_size  18.0
  /v_size  12.0
  /bounds_thickness  verification_stamp_params /bounds_thickness get
>> readonly def

/ul_verification_stamp_path % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> -
{
  [
    << /arg /year  /type /integertype  /rangecheck [ 2000 2099 ] >>
    << /arg /period  /type /stringtype  /enumcheck [ [ 1 12  range ] months  [ 1 4 range ] quarters //_year ]  /default //_year >>
    << /arg /id  /type /stringtype  /lengthcheck [ 1 3 ] >>
    << /arg /sign  /type /integertype  /rangecheck [ 0 256 ]  /default 0 >>
    << /arg /size  /type /realtype  /rangecheck [ 3 mm  18 mm ]  /default 18 mm >>
    << /arg /is_for_production  /type /booleantype  /default true >>
  ] /procs /define_args eexec

  % сохраняем на стеке текущую матрицу преобразования системы координат для последующего восстановления
  matrix currentmatrix
  currentpoint translate
  args /size get  verification_stamp_rect_params /h_size get  div  dup  scale

    args /is_for_production get
    {
        verification_stamp_rect_params /h_size get 2 div
        verification_stamp_rect_params /v_size get 2 div
      translate

      % прямоугольник
        verification_stamp_rect_params /h_size get
        verification_stamp_rect_params /v_size get
        verification_stamp_rect_params /bounds_thickness get
        0
      centered_frame

      % индивидуальный знак поверителя
        args /sign get 0 ne
        {
          matrix currentmatrix
            0 -3.5 translate
            verification_stamp_rect_params /sing_h_size get dup scale
            args /sign get stamp_sign_upath uappend
          setmatrix
        }
      if

      % год
      (stamp_year) findfont
      verification_stamp_rect_params /year_h_size get scalefont setfont
      -6.0 0 moveto
            args /year get 4 string cvs
            dup length 2 sub
            1
          getinterval
        string_center_middle
      true charpath
      6.0 0 moveto
            args /year get 4 string cvs
            dup length 1 sub
            1
          getinterval
        string_center_middle
      true charpath

      % шифр поверительного клейма
      matrix currentmatrix
        1 1 scale
        (stamp_id) findfont
        verification_stamp_rect_params /id_h_size get scalefont setfont
        0 0 moveto
          args /id get
          string_center_middle
        true charpath
      setmatrix

        args /period get () eq
        {
          % знак СТ
          0 3.5 moveto
          currentpoint translate
          verification_stamp_rect_params /rst_size get dup scale
          /image-st /ProcSet findresource /ust get  uappend
        }
        {
          % период
          (stamp_period) findfont
          verification_stamp_rect_params /period_h_size get scalefont setfont
          -2.0 3.5 moveto
            args /period get
            string_center_middle
          true charpath

          % знак СТ
          2.5 3.5 moveto
          currentpoint translate
          verification_stamp_rect_params /rst_size get dup scale
          /image-st /ProcSet findresource /ust get  uappend
        }
      ifelse
    }
    {
        verification_stamp_rect_params /h_size get 2 div
        dup
      translate

      % прямоугольник
        verification_stamp_rect_params /h_size get
        dup
        verification_stamp_rect_params /bounds_thickness get
        0
      centered_frame

      % шифр поверительного клейма организации
      (stamp_id) findfont
      verification_stamp_params /id_h_size get scalefont setfont
      0 -7.5 moveto
        args /id get
        string_center_bottom
      true charpath

      % год
      (stamp_year) findfont
      verification_stamp_params /year_h_size get scalefont setfont
      -5.5 0 moveto
            args /year get 4 string cvs
            dup length 2 sub
            1
          getinterval
        string_center_middle
      true charpath
      5.5 0 moveto
            args /year get 4 string cvs
            dup length 1 sub
            1
          getinterval
        string_center_middle
      true charpath

      % индивидуальный знак поверителя
        args /sign get 0 ne
        {
          matrix currentmatrix
            verification_stamp_params /sing_h_size get dup scale
            args /sign get stamp_sign_upath uappend
          setmatrix
        }
      if

        args /period get () eq
        {
          % знак СТ
          0 5.5 moveto
          currentpoint translate
          3 3 scale
          /image-st /ProcSet findresource /ust get  uappend
        }
        {
          % период
          (stamp_period) findfont
          verification_stamp_params /period_h_size get scalefont setfont
          -2.0 5.5 moveto
            args /period get
            string_center_middle
          true charpath

          % знак СТ
          2.5 5.5 moveto
          currentpoint translate
          3 3 scale
          /image-st /ProcSet findresource /ust get  uappend
        }
      ifelse
    }
  ifelse

  % восстановливаем систему координат
  setmatrix

  /procs /leave_local_scope eexec
} bind def

/ul_verification_stamp_upath % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> user path
{
  /ul_verification_stamp_path
  false path_as_upath
} def


% генерация рисунка поверительного клейма стального ударного (ромбовидного)

/verification_stamp_rhombus_params <<
  /h_size  18.0
  /bounds_angles_radius  18.0 4 div
  /bounds_thickness  verification_stamp_params /bounds_thickness get
  /rst_size  5.0
  /id_h_size  2.5  800 1000 div  div
  /sing_h_size  4.0  800 1000 div  div
  /year_h_size  verification_stamp_params /year_h_size get
>> readonly def

/verification_stamp_rhombus_path % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> -
{
  [
    << /arg /year  /type /integertype  /rangecheck [ 2000 2099 ] >>
    << /arg /period  /type /stringtype  /enumcheck [ [ 1 12  range ] months  [ 1 4 range ] quarters //_year ]  /default //_year >>
    << /arg /id  /type /stringtype  /lengthcheck [ 1 3 ] >>
    << /arg /sign  /type /integertype  /rangecheck [ 0 256 ]  /default 0 >>
    << /arg /size  /type /realtype  /rangecheck [ 3 mm  18 mm ]  /default 6 mm >>
    << /arg /is_for_production  /type /booleantype  /default true >>
  ] /procs /define_args eexec

  % сохраняем на стеке текущую матрицу преобразования системы координат для последующего восстановления
  matrix currentmatrix
  currentpoint translate
  args /size get  verification_stamp_rhombus_params /h_size get  div  dup  scale
  45 rotate

  verification_stamp_rhombus_params /h_size get 2 div  dup  translate

  % рамка
  matrix currentmatrix
    45 rotate
      verification_stamp_rhombus_params /h_size get
      dup
      verification_stamp_rhombus_params /bounds_thickness get
      verification_stamp_rhombus_params /bounds_angles_radius get
    centered_frame
  setmatrix

  % индивидуальный знак поверителя
    args /sign get 0 ne
    {
      matrix currentmatrix
        0 6.0 translate
        verification_stamp_rhombus_params /sing_h_size get dup scale
        args /sign get stamp_sign_upath uappend
      setmatrix
    }
  if

  % год
  (stamp_year) findfont
  verification_stamp_rhombus_params /year_h_size get scalefont setfont
  -6.0 0 moveto
        args /year get 4 string cvs
        dup length 2 sub
        1
      getinterval
    string_center_middle
  true charpath
  6.0 0 moveto
        args /year get 4 string cvs
        dup length 1 sub
        1
      getinterval
    string_center_middle
  true charpath

  % шифр поверительного клейма
  matrix currentmatrix
    1 1 scale
    (stamp_id) findfont
    verification_stamp_rhombus_params /id_h_size get scalefont setfont
    0 0 moveto
      args /id get
      string_center_middle
    true charpath
  setmatrix

  % знак СТ
  0 -6.0 moveto
  currentpoint translate
  verification_stamp_rhombus_params /rst_size get dup scale
  /image-st /ProcSet findresource /ust get  uappend

  % восстановливаем систему координат
  setmatrix

  /procs /leave_local_scope eexec
} bind def

/verification_stamp_rhombus_upath % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> user path
{
  /verification_stamp_rhombus_path
  false path_as_upath
} def


% генерация рисунка поверительного клейма
/verification_stamp_path % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> -
{
  [
    << /arg /year  /type /integertype  /rangecheck [ 2000 2099 ] >>
    << /arg /period  /type /stringtype  /enumcheck [ [ 1 12  range ] months  [ 1 4 range ] quarters //_year ]  /default //_year >>
    << /arg /id  /type /stringtype  /lengthcheck [ 1 3 ] >>
    << /arg /sign  /type /integertype  /rangecheck [ 0 256 ]  /default 0 >>
    << /arg /size  /type /realtype  /rangecheck [ 3 mm  18 mm ]  /default 18 mm >>
    << /arg /is_for_production  /type /booleantype  /default true >>
  ] /procs /define_args eexec

  args /id get  length
  <<
    1 { args gmc_verification_stamp_path } bind
    2 { args csm_verification_stamp_path } bind
    3 { args ul_verification_stamp_path } bind
  >>
  /operators /ProcSet findresource /switch get exec

  /procs /leave_local_scope eexec
} def

/verification_stamp_upath % диаметр знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> user path
{
  /verification_stamp_path
  false path_as_upath
} def


% знак калибровки
gsave
  (stamp_K) findfont
  1 scalefont  setfont
  (K) 0 stamp_sign_upath_helper
  /uK exch cvlit def
grestore

/calibration_stamp_params <<
  /h_size  verification_stamp_params /h_size get
  /bounds_thickness  verification_stamp_params /bounds_thickness get
  /period_h_size  verification_stamp_params /period_h_size get
  /sing_h_size  verification_stamp_params /period_h_size get
  /K_h_size  6.0
>> readonly def

% генерация рисунка калибровочного клейма
/calibration_stamp_path % размер знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> user path
{
  [
    << /arg /year  /type /integertype  /rangecheck [ 2000 2099 ] >>
    << /arg /period  /type /stringtype  /enumcheck [ [ 1 12  range ] months  [ 1 4 range ] quarters //_year ]  /default //_year >>
    << /arg /id  /type /stringtype  /lengthcheck [ 1 3 ] >>
    << /arg /sign  /type /integertype  /rangecheck [ 0 256 ]  /default 0 >>
    << /arg /size  /type /realtype  /rangecheck [ 3 mm  18 mm ]  /default 18 mm >>
    << /arg /is_for_production  /type /booleantype  /default true >>
  ] /procs /define_args eexec

  % сохраняем на стеке текущую матрицу преобразования системы координат для последующего восстановления
  matrix currentmatrix
  currentpoint translate
  args /size get  calibration_stamp_params /h_size get  div  dup  scale
  9 9 translate

  % квадрат
    calibration_stamp_params /h_size get
    dup
    calibration_stamp_params /bounds_thickness get
    0
  centered_frame

  % шифр клейма организации
  (stamp_id) findfont
  4 scalefont setfont
  0 -5.5 moveto
    args /id get
    string_center_middle
  true charpath

  % индивидуальный знак поверителя
    args /sign get 0 ne
    {
      matrix currentmatrix
        2.5 5.5 moveto
        currentpoint translate
        calibration_stamp_params /sing_h_size get  dup  scale
        args /sign get stamp_sign_upath uappend
      setmatrix
    }
  if

  % год
  (stamp_year) findfont
  6 scalefont setfont
  % -4 0 moveto
  -5.5 0 moveto
        args /year get 4 string cvs
        dup length 2 sub
        1
      getinterval
    % string_right_middle
    string_center_middle
  true charpath
  % 4 0 moveto
  5.5 0 moveto
        args /year get 4 string cvs
        dup length 1 sub
        1
      getinterval
    % string_left_middle
    string_center_middle
  true charpath

  % период
  (stamp_period) findfont
  calibration_stamp_params /period_h_size get scalefont setfont
  -2.5 5.5 moveto
    args /period get
    string_center_middle
  true charpath

  % знак калибровки
  0 0 moveto
  currentpoint translate
  calibration_stamp_params /K_h_size get dup scale
  uK uappend

  % восстановливаем систему координат
  setmatrix

  /procs /leave_local_scope eexec
} bind def

/calibration_stamp_upath % размер знак_поверителя (шифр клейма) (период) год при_выпуске_из_производства --> user path
{
  /calibration_stamp_path
  false path_as_upath
} def

/create_stamps % год [массив периодов] (шифр клейма) [массив знаков поверителей] размер при_выпуске_из_производства функция_генерации  --> выполнение функции генерации для всех заданных клейм
{
  [
    << /arg /year  /type /integertype  /rangecheck [ 2000 2099 ] >>
    << /arg /period  /type /arraytype  /default [ //_year ] >>
    << /arg /id  /type /stringtype  /lengthcheck [ 1 3 ] >>
    << /arg /sign  /type /arraytype  /default [ 0 ] >>
    << /arg /size  /type /realtype  /rangecheck [ 3 mm  18 mm ]  /default 18 mm >>
    << /arg /is_for_production  /type /booleantype  /default true >>
    << /arg /functor  /type /nametype  /enumcheck [ /verification_stamp_upath /verification_stamp_rhombus_upath /calibration_stamp_upath ]  /default /verification_stamp_upath >>
  ] /procs /define_args eexec

  args  dup length dict  copy begin
    {
      currentdict /functor undef
      args /period get {
        /period exch def
        args /sign get {
          /sign exch def
          currentdict  args /functor get load  exec
        } forall
      } forall
    } stopped
  end

  /procs /leave_local_scope eexec

  { stop } if
} def

currentdict end  dup length dict copy  /ProcSet defineresource pop
%%EndResource:
%} ifelse

end % /graphics-alignments /ProcSet findresource begin
end % /si /ProcSet findresource begin
end % /graphics /ProcSet findresource begin
end % /boxes /ProcSet findresource begin

%%EndProlog
